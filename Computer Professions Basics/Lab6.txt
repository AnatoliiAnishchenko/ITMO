ORG	0
RET:	WORD	?
	NOP		;HLT -- get A to check working
	BR	INTR


ORG 5
X:	WORD	0000
SAVE_A:	WORD	?
SAVE_C:	WORD	?
TMP:	WORD	?
MAX:	WORD	001E	
MIN:	WORD	FFDF
CONST5:	WORD	0005
CONST3:	WORD	0003
MASK:	WORD	0080
MINUS:	WORD	FF00


ORG	20
BEGIN:	EI		;main programm
LOOP:	CLA
	ADD	X
	SUB	CONST3
	DI
	JSR	CHECK
	EI
	MOV	X
	BR	LOOP


ORG	50
INTR:	MOV	SAVE_A	;INTR -- interrupte
	ROL
	MOV	SAVE_C
	
ASK1:	TSF	1
	BR	ASK3
	JSR	FUNC
	OUT	1
	CLF	1
	BR	RES	
		
ASK3:	TSF	3
	BR	OTHER
	CLA
	IN	3
	CLF	3
	MOV	TMP
	AND	MASK
	BEQ	PLUS
	CLA
	ADD	MINUS
PLUS:	ADD	TMP
	SUB	X
	JSR	CHECK
	MOV	X
	BR	RES

OTHER:	CLF	0
	CLF	2
	CLF	4
	CLF	5
	CLF	6
	CLF	7
	CLF	8
	CLF	9
	BR REC


FUNC:	WORD	?	;get function
	CLA
	SUB	X
	SUB	X
	SUB	X
	SUB	X
	SUB	CONST5
	BR	(FUNC)
	

CHECK:	WORD	?	;check ODZ
	SUB	MIN
	BMI	NEW_X
	ADD	MIN
	SUB	MAX
	BEQ	FIX
	BPL	NEW_X
	BR	FIX
NEW_X:	CLA
FIX:	ADD	MAX
	BR	(CHECK)


REC:	CLA		;REC -- recover
	ADD	SAVE_C
	ROR
	CLA
	CMA
	AND	SAVE_A
	NOP		;HLT -- get A to check working
	EI
	BR	(RET)